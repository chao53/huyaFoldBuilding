{"version":3,"sources":["floorScript.js"],"names":["cc","Class","extends","Component","properties","lastfloor","default","type","Node","spriteFrame2","SpriteFrame","spriteFrame3","spriteFrame4","spriteFrame5","spriteFrame6","spriteFrame7","spriteFrame8","spriteFrame9","spriteFrame10","world","state","target","onLoad","accelerate","speed","angleSpeed","barycenter1","node","x","barycenter2","bindnode","node1","node2","changeState","getComponent","active","changeState2","i","getbarycenter","getLastpos1","getLastpos2","changeSprite","id","self","spriteFrame","Sprite","start","update","dt","y","Math","abs","anchorX","anchorY","falldown","VeryPerfect","gameOver","angle"],"mappings":";;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;;AAEAA,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,gBAAY;AACRC,mBAAW;AACPC,qBAAS,IADF;AAEPC,kBAAMP,GAAGQ;AAFF,SADH;AAKRC,sBAAc;AACVH,qBAAS,IADC;AAEVC,kBAAMP,GAAGU;AAFC,SALN;AASRC,sBAAc;AACVL,qBAAS,IADC;AAEVC,kBAAMP,GAAGU;AAFC,SATN;AAaRE,sBAAc;AACVN,qBAAS,IADC;AAEVC,kBAAMP,GAAGU;AAFC,SAbN;AAiBRG,sBAAc;AACVP,qBAAS,IADC;AAEVC,kBAAMP,GAAGU;AAFC,SAjBN;AAqBRI,sBAAc;AACVR,qBAAS,IADC;AAEVC,kBAAMP,GAAGU;AAFC,SArBN;AAyBRK,sBAAc;AACVT,qBAAS,IADC;AAEVC,kBAAMP,GAAGU;AAFC,SAzBN;AA6BRM,sBAAc;AACVV,qBAAS,IADC;AAEVC,kBAAMP,GAAGU;AAFC,SA7BN;AAiCRO,sBAAc;AACVX,qBAAS,IADC;AAEVC,kBAAMP,GAAGU;AAFC,SAjCN;AAqCRQ,uBAAe;AACXZ,qBAAS,IADE;AAEXC,kBAAMP,GAAGU;AAFE,SArCP;AAyCRS,eAAO;AACHb,qBAAS,IADN;AAEHC,kBAAMP,GAAGQ;AAFN,SAzCC;AA6CRY,eAAO,CA7CC,EA6CE;AACVC,gBAAQrB,GAAGQ;AA9CH,KAHP;;AAoDL;;AAEAc,UAtDK,oBAsDI;AACL,aAAKC,UAAL,GAAkB,IAAlB;AACA,aAAKC,KAAL,GAAa,CAAb;AACA,aAAKC,UAAL,GAAkB,CAAlB;AACA,aAAKC,WAAL,GAAmB,KAAKC,IAAL,CAAUC,CAA7B;AACA,aAAKC,WAAL,GAAmB,KAAKF,IAAL,CAAUC,CAA7B;AACH,KA5DI;;;AA8DLE,cAAU,kBAASC,KAAT,EAAgBC,KAAhB,EAAuB;AAC7B,aAAK3B,SAAL,GAAiB0B,KAAjB;AACA,aAAKZ,KAAL,GAAaa,KAAb;AACH,KAjEI;;AAmELC,iBAAa,uBAAW;AACpB,YAAI,KAAKb,KAAL,GAAa,CAAjB,EAAoB;AAChB,iBAAKA,KAAL,IAAc,CAAd;AACA,iBAAKf,SAAL,CAAe6B,YAAf,CAA4B,aAA5B,EAA2CD,WAA3C;AACH,SAHD,MAGO,IAAI,KAAKb,KAAL,IAAc,CAAlB,EAAqB;AACxB,iBAAKO,IAAL,CAAUQ,MAAV,GAAmB,KAAnB;AACH;AACJ,KA1EI;;AA4ELC,kBAAc,sBAASC,CAAT,EAAY;AACtB,aAAKjB,KAAL,GAAaiB,CAAb;AACH,KA9EI;;AAiFLC,mBAAe,yBAAW;AAAE;AACxB,eAAO,KAAKZ,WAAZ;AACH,KAnFI;;AAqFLa,iBAAa,uBAAW;AAAE;AACtB,eAAO,KAAKlC,SAAL,CAAeuB,CAAtB;AACH,KAvFI;;AAyFLY,iBAAa,uBAAW;AAAE;AACtB,eAAO,KAAKnC,SAAL,CAAe6B,YAAf,CAA4B,aAA5B,EAA2CK,WAA3C,EAAP;AACH,KA3FI;;AA6FLE,kBAAc,sBAASC,EAAT,EAAa;AACvB,YAAIC,OAAO,IAAX;AACA,YAAIC,WAAJ;AACA,gBAAQF,EAAR;AACI,iBAAK,CAAL;AACIE,8BAAc,KAAKnC,YAAnB;AACA;AACJ,iBAAK,CAAL;AACImC,8BAAc,KAAKjC,YAAnB;AACA;AACJ,iBAAK,CAAL;AACIiC,8BAAc,KAAKhC,YAAnB;AACA;AACJ,iBAAK,CAAL;AACIgC,8BAAc,KAAK/B,YAAnB;AACA;AACJ,iBAAK,CAAL;AACI+B,8BAAc,KAAK9B,YAAnB;AACA;AACJ,iBAAK,CAAL;AACI8B,8BAAc,KAAK7B,YAAnB;AACA;AACJ,iBAAK,CAAL;AACI6B,8BAAc,KAAK5B,YAAnB;AACA;AACJ,iBAAK,CAAL;AACI4B,8BAAc,KAAK3B,YAAnB;AACA;AACJ,iBAAK,EAAL;AACI2B,8BAAc,KAAK1B,aAAnB;AACA;AACJ;AACI;AA7BR;AA+BAyB,aAAKhB,IAAL,CAAUO,YAAV,CAAuBlC,GAAG6C,MAA1B,EAAkCD,WAAlC,GAAgDA,WAAhD;AACH,KAhII;;AAkILE,SAlIK,mBAkIG,CAEP,CApII;AAsILC,UAtIK,kBAsIEC,EAtIF,EAsIM;AACP,YAAI,KAAK5B,KAAL,IAAc,CAAlB,EAAqB;AACjB,gBAAI,KAAKO,IAAL,CAAUsB,CAAV,GAAc,IAAlB,EAAwB;AACpB,qBAAKzB,KAAL,IAAc,KAAKD,UAAL,GAAkByB,EAAhC;AACA,qBAAKrB,IAAL,CAAUsB,CAAV,IAAe,KAAKzB,KAAL,GAAawB,EAA5B;AACH,aAHD,MAGO;AACH,oBAAIE,KAAKC,GAAL,CAAS,KAAK9C,SAAL,CAAeuB,CAAf,GAAmB,KAAKD,IAAL,CAAUC,CAAtC,KAA4C,GAAhD,EAAqD;AAAE;AACnD,yBAAKR,KAAL,GAAa,CAAb;AACH,iBAFD,MAEO,IAAI,KAAKf,SAAL,CAAeuB,CAAf,GAAmB,KAAKD,IAAL,CAAUC,CAA7B,GAAiC,GAArC,EAA0C;AAAE;AAC/C,yBAAKR,KAAL,GAAa,CAAb;AACA,yBAAKO,IAAL,CAAUyB,OAAV,GAAoB,CAAC,KAAK/C,SAAL,CAAeuB,CAAf,GAAmB,KAAKD,IAAL,CAAUC,CAA9B,IAAmC,GAAvD;AACA,yBAAKD,IAAL,CAAU0B,OAAV,GAAoB,CAApB,CAH6C,CAGtB;AACvB,yBAAK1B,IAAL,CAAUC,CAAV,IAAe,MAAM,KAAKD,IAAL,CAAUyB,OAAhB,GAA0B,GAAzC;AACA,yBAAKzB,IAAL,CAAUsB,CAAV,IAAe,GAAf;AACH,iBANM,MAMA,IAAI,KAAK5C,SAAL,CAAeuB,CAAf,GAAmB,KAAKD,IAAL,CAAUC,CAA7B,GAAiC,CAAC,GAAtC,EAA2C;AAAE;AAChD,yBAAKR,KAAL,GAAa,CAAb;AACA,yBAAKO,IAAL,CAAUyB,OAAV,GAAoB,IAAI,CAAC,KAAK/C,SAAL,CAAeuB,CAAf,GAAmB,KAAKD,IAAL,CAAUC,CAA9B,IAAmC,GAA3D;AACA,yBAAKD,IAAL,CAAU0B,OAAV,GAAoB,CAApB,CAH8C,CAGvB;AACvB,yBAAK1B,IAAL,CAAUC,CAAV,IAAe,MAAM,KAAKD,IAAL,CAAUyB,OAAhB,GAA0B,GAAzC;AACA,yBAAKzB,IAAL,CAAUsB,CAAV,IAAe,GAAf;AACH,iBANM,MAMA;AACH,yBAAKvB,WAAL,GAAmB,CAAC,KAAKC,IAAL,CAAUC,CAAV,GAAc,KAAKvB,SAAL,CAAeuB,CAA9B,IAAmC,CAAtD;AACA,yBAAKC,WAAL,GAAmB,CAAC,KAAKF,IAAL,CAAUC,CAAV,GAAc,IAAI,KAAKvB,SAAL,CAAe6B,YAAf,CAA4B,aAA5B,EAA2CI,aAA3C,EAAnB,IAAiF,CAApG;AACA,wBAAI,KAAKE,WAAL,KAAqB,KAAKd,WAA1B,GAAwC,GAAxC,IAA+C,KAAKrB,SAAL,CAAe6B,YAAf,CAA4B,aAA5B,EAA2CM,WAA3C,KAA2D,KAAKX,WAAhE,GAA8E,GAAjI,EAAsI;AAClI,6BAAKV,KAAL,CAAWe,YAAX,CAAwB,aAAxB,EAAuCoB,QAAvC,CAAgD,CAAhD;AACH,qBAFD,MAEO,IAAI,KAAKd,WAAL,KAAqB,KAAKd,WAA1B,GAAwC,CAAC,GAAzC,IAAgD,KAAKrB,SAAL,CAAe6B,YAAf,CAA4B,aAA5B,EAA2CM,WAA3C,KAA2D,KAAKX,WAAhE,GAA8E,CAAC,GAAnI,EAAwI;AAC3I,6BAAKV,KAAL,CAAWe,YAAX,CAAwB,aAAxB,EAAuCoB,QAAvC,CAAgD,CAAC,CAAjD;AACH,qBAFM,MAEA;AACH,6BAAK3B,IAAL,CAAUsB,CAAV,GAAc,IAAd;AACH;AACD,wBAAGC,KAAKC,GAAL,CAAS,KAAK9C,SAAL,CAAeuB,CAAf,GAAmB,KAAKD,IAAL,CAAUC,CAAtC,KAA4C,EAA/C,EAAkD;AAC9C,6BAAKT,KAAL,CAAWe,YAAX,CAAwB,aAAxB,EAAuCqB,WAAvC;AACH;AACJ;AACJ;AACJ,SAlCD,MAkCO,IAAI,KAAKnC,KAAL,IAAc,CAAlB,EAAqB;AACxB,gBAAI,KAAKO,IAAL,CAAUsB,CAAV,GAAc,IAAlB,EAAwB;AACpB,qBAAKtB,IAAL,CAAUsB,CAAV,IAAe,SAASD,EAAxB;AACH,aAFD,MAEO;AACH,qBAAKrB,IAAL,CAAUsB,CAAV,GAAc,IAAd;AACH;AACJ,SANM,MAMA,IAAI,KAAK7B,KAAL,IAAc,CAAlB,EAAqB;AACxB,gBAAI,KAAKO,IAAL,CAAUsB,CAAV,GAAc,IAAlB,EAAwB;AACpB,qBAAKtB,IAAL,CAAUsB,CAAV,IAAe,SAASD,EAAxB;AACH,aAFD,MAEO;AACH,qBAAKrB,IAAL,CAAUsB,CAAV,GAAc,IAAd;AACH;AACJ,SANM,MAMA,IAAI,KAAK7B,KAAL,IAAc,CAAlB,EAAqB;AACxB,gBAAI,KAAKO,IAAL,CAAUsB,CAAV,GAAc,IAAlB,EAAwB;AACpB,qBAAKtB,IAAL,CAAUsB,CAAV,IAAe,SAASD,EAAxB;AACH,aAFD,MAEO;AACH,qBAAKrB,IAAL,CAAUsB,CAAV,GAAc,IAAd;AACH;AACJ,SANM,MAMA,IAAI,KAAK7B,KAAL,IAAc,CAAlB,EAAqB;AACxB,gBAAI,KAAKO,IAAL,CAAUsB,CAAV,GAAc,IAAlB,EAAwB;AACpB,qBAAKtB,IAAL,CAAUsB,CAAV,IAAe,SAASD,EAAxB;AACH,aAFD,MAEO;AACH,qBAAKrB,IAAL,CAAUsB,CAAV,GAAc,IAAd;AACH;AACJ,SANM,MAMA,IAAI,KAAK7B,KAAL,IAAc,CAAlB,EAAqB,CAE3B,CAFM,MAEA,IAAI,KAAKA,KAAL,IAAc,CAAlB,EAAqB;AACxB,iBAAKD,KAAL,CAAWe,YAAX,CAAwB,aAAxB,EAAuCsB,QAAvC;AACA,gBAAI,KAAK7B,IAAL,CAAUsB,CAAV,GAAc,IAAlB,EAAwB;AACpB,qBAAKzB,KAAL,IAAc,KAAKD,UAAL,GAAkByB,EAAhC;AACA,qBAAKrB,IAAL,CAAUsB,CAAV,IAAe,KAAKzB,KAAL,GAAawB,EAA5B;AACH,aAHD,MAGO;AACH,qBAAKrB,IAAL,CAAUsB,CAAV,GAAc,IAAd;AACH;AACJ,SARM,MAQA,IAAI,KAAK7B,KAAL,IAAc,CAAlB,EAAqB;AACxB,gBAAI,KAAKO,IAAL,CAAU8B,KAAV,GAAkB,EAAtB,EAA0B;AACtB,qBAAKhC,UAAL,IAAmB,OAAOuB,EAA1B;AACA,qBAAKrB,IAAL,CAAU8B,KAAV,IAAmB,KAAKhC,UAAL,GAAkBuB,EAArC;AACH,aAHD,MAGO;AACH,qBAAK5B,KAAL,GAAa,CAAb;AACH;AACJ,SAPM,MAOA,IAAI,KAAKA,KAAL,IAAc,CAAlB,EAAqB;AACxB,gBAAI,KAAKO,IAAL,CAAU8B,KAAV,GAAkB,CAAC,EAAvB,EAA2B;AACvB,qBAAKhC,UAAL,IAAmB,OAAOuB,EAA1B;AACA,qBAAKrB,IAAL,CAAU8B,KAAV,IAAmB,KAAKhC,UAAL,GAAkBuB,EAArC;AACH,aAHD,MAGO;AACH,qBAAK5B,KAAL,GAAa,CAAb;AACH;AACJ;AACJ;AA1NI,CAAT","file":"floorScript.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["// Learn cc.Class:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        lastfloor: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n        spriteFrame2: {\r\n            default: null,\r\n            type: cc.SpriteFrame,\r\n        },\r\n        spriteFrame3: {\r\n            default: null,\r\n            type: cc.SpriteFrame,\r\n        },\r\n        spriteFrame4: {\r\n            default: null,\r\n            type: cc.SpriteFrame,\r\n        },\r\n        spriteFrame5: {\r\n            default: null,\r\n            type: cc.SpriteFrame,\r\n        },\r\n        spriteFrame6: {\r\n            default: null,\r\n            type: cc.SpriteFrame,\r\n        },\r\n        spriteFrame7: {\r\n            default: null,\r\n            type: cc.SpriteFrame,\r\n        },\r\n        spriteFrame8: {\r\n            default: null,\r\n            type: cc.SpriteFrame,\r\n        },\r\n        spriteFrame9: {\r\n            default: null,\r\n            type: cc.SpriteFrame,\r\n        },\r\n        spriteFrame10: {\r\n            default: null,\r\n            type: cc.SpriteFrame,\r\n        },\r\n        world: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n        state: 0, //1-4正常 5销毁 6直线下坠 7向左滚\r\n        target: cc.Node,\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad() {\r\n        this.accelerate = 5000;\r\n        this.speed = 0;\r\n        this.angleSpeed = 0;\r\n        this.barycenter1 = this.node.x;\r\n        this.barycenter2 = this.node.x;\r\n    },\r\n\r\n    bindnode: function(node1, node2) {\r\n        this.lastfloor = node1;\r\n        this.world = node2;\r\n    },\r\n\r\n    changeState: function() {\r\n        if (this.state < 4) {\r\n            this.state += 1;\r\n            this.lastfloor.getComponent('floorScript').changeState();\r\n        } else if (this.state == 4) {\r\n            this.node.active = false;\r\n        }\r\n    },\r\n\r\n    changeState2: function(i) {\r\n        this.state = i;\r\n    },\r\n\r\n\r\n    getbarycenter: function() { //返回重心\r\n        return this.barycenter1;\r\n    },\r\n\r\n    getLastpos1: function() { //返回下层坐标\r\n        return this.lastfloor.x;\r\n    },\r\n\r\n    getLastpos2: function() { //返回下下层坐标\r\n        return this.lastfloor.getComponent(\"floorScript\").getLastpos1();\r\n    },\r\n\r\n    changeSprite: function(id) {\r\n        var self = this;\r\n        var spriteFrame;\r\n        switch (id) {\r\n            case 2:\r\n                spriteFrame = this.spriteFrame2;\r\n                break;\r\n            case 3:\r\n                spriteFrame = this.spriteFrame3;\r\n                break;\r\n            case 4:\r\n                spriteFrame = this.spriteFrame4;\r\n                break;\r\n            case 5:\r\n                spriteFrame = this.spriteFrame5;\r\n                break;\r\n            case 6:\r\n                spriteFrame = this.spriteFrame6;\r\n                break;\r\n            case 7:\r\n                spriteFrame = this.spriteFrame7;\r\n                break;\r\n            case 8:\r\n                spriteFrame = this.spriteFrame8;\r\n                break;\r\n            case 9:\r\n                spriteFrame = this.spriteFrame9;\r\n                break;\r\n            case 10:\r\n                spriteFrame = this.spriteFrame10;\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n        self.node.getComponent(cc.Sprite).spriteFrame = spriteFrame;\r\n    },\r\n\r\n    start() {\r\n\r\n    },\r\n\r\n    update(dt) {\r\n        if (this.state == 0) {\r\n            if (this.node.y > 2740) {\r\n                this.speed += this.accelerate * dt;\r\n                this.node.y -= this.speed * dt;\r\n            } else {\r\n                if (Math.abs(this.lastfloor.x - this.node.x) >= 500) { //判断是否落空\r\n                    this.state = 6;\r\n                } else if (this.lastfloor.x - this.node.x > 250) { //向左滚\r\n                    this.state = 7;\r\n                    this.node.anchorX = (this.lastfloor.x - this.node.x) / 500;\r\n                    this.node.anchorY = 0; //重新设置锚点，基于锚点旋转\r\n                    this.node.x += 500 * this.node.anchorX - 250;\r\n                    this.node.y -= 150;\r\n                } else if (this.lastfloor.x - this.node.x < -250) { //向右滚\r\n                    this.state = 8;\r\n                    this.node.anchorX = 1 + (this.lastfloor.x - this.node.x) / 500;\r\n                    this.node.anchorY = 0; //重新设置锚点，基于锚点旋转\r\n                    this.node.x += 500 * this.node.anchorX - 250;\r\n                    this.node.y -= 150;\r\n                } else {\r\n                    this.barycenter1 = (this.node.x + this.lastfloor.x) / 2;\r\n                    this.barycenter2 = (this.node.x + 2 * this.lastfloor.getComponent(\"floorScript\").getbarycenter()) / 3;\r\n                    if (this.getLastpos2() - this.barycenter1 > 250 || this.lastfloor.getComponent(\"floorScript\").getLastpos2() - this.barycenter2 > 250) {\r\n                        this.world.getComponent('eventSystem').falldown(1);\r\n                    } else if (this.getLastpos2() - this.barycenter1 < -250 || this.lastfloor.getComponent(\"floorScript\").getLastpos2() - this.barycenter2 < -250) {\r\n                        this.world.getComponent('eventSystem').falldown(-1);\r\n                    } else {\r\n                        this.node.y = 2740;\r\n                    }\r\n                    if(Math.abs(this.lastfloor.x - this.node.x) <= 30){\r\n                        this.world.getComponent('eventSystem').VeryPerfect();\r\n                    }\r\n                }\r\n            }\r\n        } else if (this.state == 1) {\r\n            if (this.node.y > 2440) {\r\n                this.node.y -= 428.57 * dt;\r\n            } else {\r\n                this.node.y = 2440;\r\n            }\r\n        } else if (this.state == 2) {\r\n            if (this.node.y > 2140) {\r\n                this.node.y -= 428.57 * dt;\r\n            } else {\r\n                this.node.y = 2140;\r\n            }\r\n        } else if (this.state == 3) {\r\n            if (this.node.y > 1840) {\r\n                this.node.y -= 428.57 * dt;\r\n            } else {\r\n                this.node.y = 1840;\r\n            }\r\n        } else if (this.state == 4) {\r\n            if (this.node.y > 1540) {\r\n                this.node.y -= 428.57 * dt;\r\n            } else {\r\n                this.node.y = 1540;\r\n            }\r\n        } else if (this.state == 5) {\r\n\r\n        } else if (this.state == 6) {\r\n            this.world.getComponent('eventSystem').gameOver();\r\n            if (this.node.y > 1540) {\r\n                this.speed += this.accelerate * dt;\r\n                this.node.y -= this.speed * dt;\r\n            } else {\r\n                this.node.y = 1540;\r\n            }\r\n        } else if (this.state == 7) {\r\n            if (this.node.angle < 90) {\r\n                this.angleSpeed += 1000 * dt;\r\n                this.node.angle += this.angleSpeed * dt;\r\n            } else {\r\n                this.state = 6;\r\n            }\r\n        } else if (this.state == 8) {\r\n            if (this.node.angle > -90) {\r\n                this.angleSpeed += 1000 * dt;\r\n                this.node.angle -= this.angleSpeed * dt;\r\n            } else {\r\n                this.state = 6;\r\n            }\r\n        }\r\n    },\r\n});"]}