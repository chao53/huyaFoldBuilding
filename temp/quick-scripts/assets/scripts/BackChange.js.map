{"version":3,"sources":["BackChange.js"],"names":["cc","Class","extends","Component","properties","SpriteFrame1","default","type","SpriteFrame","SpriteFrame2","SpriteFrame3","CycleFrame","back","Prefab","width","height","offset","movespeed","rate","downtime","time","begincycle","alloffset","start","console","debug","hblew","createSprite","curcyc","instantiate","node","addChild","size","getOriginalSize","setPosition","sprite","getComponent","Sprite","spriteFrame","sf","cur","zindex","curspr","movedown","y","children","changeframe","lower","heigher","startdown","update","dt","eventTrigger"],"mappings":"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","file":"BackChange.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        SpriteFrame1: {\r\n            default: null,\r\n            type: cc.SpriteFrame,\r\n        },\r\n        SpriteFrame2:{\r\n            default:null,\r\n            type: cc.SpriteFrame,\r\n        },\r\n        SpriteFrame3:{\r\n            default:null,\r\n            type: cc.SpriteFrame,\r\n        },\r\n\r\n        CycleFrame: {\r\n            default: null,\r\n            type: cc.SpriteFrame,\r\n        },\r\n        back: {\r\n            default: null,\r\n            type: cc.Prefab,\r\n        },\r\n        width: 0,\r\n        height: 0,\r\n        offset: 0,\r\n        movespeed: 0,\r\n        rate: 0,\r\n        downtime: 0,\r\n        time: 0,\r\n        begincycle: false,\r\n        alloffset:0,\r\n    },\r\n   \r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    // onLoad () {},\r\n\r\n    start() { //初始化图片\r\n        console.debug(this.alloffset);\r\n     \r\n        let hblew = 0;\r\n        this.createSprite(this.SpriteFrame1,hblew);\r\n        hblew+=this.width*this.rate;\r\n        this.createSprite(this.SpriteFrame2,hblew);\r\n        hblew+=this.width*this.rate;\r\n        this.createSprite(this.SpriteFrame3,hblew);\r\n        hblew+=this.width*this.rate;\r\n        \r\n        var curcyc = cc.instantiate(this.back);\r\n        this.node.addChild(curcyc);\r\n        let size = this.CycleFrame.getOriginalSize();\r\n        this.rate = size.height / size.width;\r\n        curcyc.setPosition(this.width / 2, hblew+ this.width * this.rate / 2);\r\n        curcyc.width = this.width;\r\n        curcyc.height = this.width * this.rate;\r\n        let sprite = curcyc.getComponent(cc.Sprite);\r\n        sprite.spriteFrame = this.CycleFrame;\r\n\r\n    },\r\n\r\n    createSprite:function(sf,hblew){\r\n        var cur = cc.instantiate(this.back);\r\n        let size = sf.getOriginalSize();\r\n        this.rate = size.height / size.width;\r\n        console.debug(this.rate);\r\n        this.zindex = -1000;\r\n        //cur.setLocalZOrder(-1);\r\n        this.node.addChild(cur);\r\n        let curspr = cur.getComponent(cc.Sprite);\r\n        curspr.spriteFrame = sf;\r\n        cur.width = this.width;\r\n        //this.height = this.width*this.rate;\r\n        cur.height = this.width * this.rate;\r\n        cur.setPosition(cur.width / 2, hblew+cur.height / 2);\r\n    },\r\n\r\n    movedown: function() {\r\n        this.node.y -= this.movespeed;\r\n        this.offset += this.movespeed;\r\n        this.alloffset +=this.movespeed;\r\n        //console.debug(this.node.children[0].height+this.node.children[1].height);\r\n        //console.debug(this.offset);\r\n        if (this.begincycle == false) { //判断是否该加载图片\r\n            if (this.offset + this.height + 600 >= this.node.children[0].height + this.node.children[1].height) { //600为预加载\r\n                this.changeframe();\r\n            }\r\n        } else {\r\n            let lower;\r\n            let heigher;\r\n            if (this.node.children[0].y < this.node.children[1].y) {\r\n                lower = this.node.children[0];\r\n                heigher = this.node.children[1];\r\n                //console.debug(\"1\");\r\n            } else {\r\n                lower = this.node.children[1];\r\n                heigher = this.node.children[0];\r\n                //console.debug(\"2\");\r\n            }\r\n            if (this.offset + 600 >= heigher.height) { //600为预加载\r\n                this.changeframe();\r\n            }\r\n        }\r\n\r\n    },\r\n    startdown: function() { //开始下移外部调用\r\n        this.time = 0;\r\n    },\r\n    update(dt) {\r\n        if (this.time < this.downtime) {\r\n            this.movedown();\r\n            this.time += dt;\r\n        }\r\n        this.getComponent('midwayEvent').eventTrigger(this.alloffset,this.offset);\r\n       // console.debug(this.alloffset);\r\n\r\n    },\r\n    changeframe: function() { //切换图片\r\n            let lower;\r\n            let heigher;\r\n            if (this.node.children[0].y < this.node.children[1].y) {\r\n                lower = this.node.children[0];\r\n                heigher = this.node.children[1];\r\n                console.debug(\"1\");\r\n            } else {\r\n                lower = this.node.children[1];\r\n                heigher = this.node.children[0];\r\n                console.debug(\"2\");\r\n            }\r\n            console.debug(\"change\");\r\n            let size = this.CycleFrame.getOriginalSize();\r\n            this.rate = size.height / size.width;\r\n\r\n            //let cur = this.node.children[0];\r\n            //console.debug(lower.y);\r\n            //console.debug(heigher.y);\r\n            lower.y += heigher.height + lower.height;\r\n            lower.y -= this.offset;\r\n            heigher.y -= this.offset;\r\n            //console.debug(lower.y);\r\n            //console.debug(heigher.y);\r\n            let sprite = lower.getComponent(cc.Sprite);\r\n            sprite.width = this.width;\r\n            sprite.height = this.width * this.rate;\r\n            this.node.setPosition(-630, -1170);\r\n            this.offset = 0;\r\n            console.debug(this.offset);\r\n            sprite.spriteFrame = this.CycleFrame;\r\n            this.begincycle = true;\r\n        }\r\n        // update (dt) {},\r\n});"]}